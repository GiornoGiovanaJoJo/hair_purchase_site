# -*- coding: utf-8 -*-
"""
Точный калькулятор цены волос по таблице

Все цены жёстко определены в таблице.
Нет модификаторов - только прямой поиск по матрице.

Формула: ЦЕНА = ТАБЛИЦА[длина][цвет][структура]
"""

# ============================================
# ТОЧНАЯ ТАБЛИЦА ЦЕН 
# (все 75 комбинаций длина × цвет × структура)
# ============================================

PRICE_TABLE = {
    '40-50': {
        'блонд': {'славянка': 25000, 'среднее': 20000, 'густые': 25000},
        'светло-русые': {'славянка': 25000, 'среднее': 20000, 'густые': 25000},
        'русые': {'славянка': 20000, 'среднее': 18000, 'густые': 20000},
        'темно-русые': {'славянка': 20000, 'среднее': 18000, 'густые': 20000},
        'каштановые': {'славянка': 20000, 'среднее': 18000, 'густые': 20000},
    },
    '50-60': {
        'блонд': {'славянка': 35000, 'среднее': 30000, 'густые': 35000},
        'светло-русые': {'славянка': 35000, 'среднее': 30000, 'густые': 35000},
        'русые': {'славянка': 30000, 'среднее': 28000, 'густые': 30000},
        'темно-русые': {'славянка': 30000, 'среднее': 28000, 'густые': 30000},
        'каштановые': {'славянка': 28000, 'среднее': 25000, 'густые': 28000},
    },
    '60-80': {
        'блонд': {'славянка': 45000, 'среднее': 40000, 'густые': 45000},
        'светло-русые': {'славянка': 45000, 'среднее': 40000, 'густые': 45000},
        'русые': {'славянка': 40000, 'среднее': 38000, 'густые': 40000},
        'темно-русые': {'славянка': 40000, 'среднее': 38000, 'густые': 40000},
        'каштановые': {'славянка': 35000, 'среднее': 35000, 'густые': 38000},
    },
    '80-100': {
        'блонд': {'славянка': 55000, 'среднее': 50000, 'густые': 55000},
        'светло-русые': {'славянка': 55000, 'среднее': 50000, 'густые': 55000},
        'русые': {'славянка': 50000, 'среднее': 48000, 'густые': 50000},
        'темно-русые': {'славянка': 48000, 'среднее': 45000, 'густые': 48000},
        'каштановые': {'славянка': 48000, 'среднее': 45000, 'густые': 48000},
    },
    '100+': {
        'блонд': {'славянка': 65000, 'среднее': 60000, 'густые': 65000},
        'светло-русые': {'славянка': 65000, 'среднее': 60000, 'густые': 65000},
        'русые': {'славянка': 60000, 'среднее': 58000, 'густые': 60000},
        'темно-русые': {'славянка': 58000, 'среднее': 55000, 'густые': 58000},
        'каштановые': {'славянка': 55000, 'среднее': 55000, 'густые': 58000},
    }
}


def calculate_hair_price(
    length: int,
    color: str = 'блонд',
    structure: str = 'среднее',
    condition: str = 'натуральные',
    age: str = 'взрослые'
) -> int:
    """
    Рассчитывает цену волос по ТОЧНОЙ таблице.
    
    Args:
        length (int): Длина волос в см (40-150)
        color (str): Цвет волос
            - 'блонд'
            - 'светло-русые'
            - 'русые'
            - 'темно-русые'
            - 'каштановые'
        structure (str): Структура волос
            - 'славянка' (тонкие)
            - 'среднее'
            - 'густые'
        condition (str): Состояние волос (НЕ ИСПОЛЬЗУЕТСЯ, только для совместимости)
        age (str): Возраст (НЕ ИСПОЛЬЗУЕТСЯ, только для совместимости)
    
    Returns:
        int: Цена в рублях
    
    Examples:
        >>> calculate_hair_price(60, 'блонд', 'славянка')
        35000
        >>> calculate_hair_price(60, 'блонд', 'среднее')
        30000
    """
    
    try:
        # Нормализуем длину
        length = int(length) if length else 50
        if length < 40:
            length = 40
        elif length > 150:
            length = 150
        
        # Определяем диапазон длины
        if length < 50:
            length_range = '40-50'
        elif length < 60:
            length_range = '50-60'
        elif length < 80:
            length_range = '60-80'
        elif length < 100:
            length_range = '80-100'
        else:
            length_range = '100+'
        
        # Нормализуем цвет
        color = str(color).strip().lower()
        color_mapping = {
            'блонд': 'блонд',
            'светло-русые': 'светло-русые',
            'светлорусые': 'светло-русые',
            'русые': 'русые',
            'темно-русые': 'темно-русые',
            'темнорусые': 'темно-русые',
            'каштановые': 'каштановые',
            'каштан': 'каштановые',
        }
        color = color_mapping.get(color, 'блонд')
        
        # Нормализуем структуру
        structure = str(structure).strip().lower()
        structure_mapping = {
            'славянка': 'славянка',
            'славянки': 'славянка',
            'тонкие': 'славянка',
            'среднее': 'среднее',
            'средние': 'среднее',
            'густые': 'густые',
        }
        structure = structure_mapping.get(structure, 'среднее')
        
        # Получаем цену из таблицы
        price = PRICE_TABLE[length_range][color][structure]
        return int(price)
        
    except Exception as e:
        import logging
        logger = logging.getLogger(__name__)
        logger.error(f'Error calculating hair price: {e}', exc_info=True)
        return 30000  # Safe default


def get_price_range(length: int = 50) -> dict:
    """
    Возвращает минимальную и максимальную цену для заданной длины.
    
    Args:
        length (int): Длина в см
    
    Returns:
        dict: {'min': int, 'max': int}
    """
    length = int(length) if length else 50
    if length < 50:
        length_range = '40-50'
    elif length < 60:
        length_range = '50-60'
    elif length < 80:
        length_range = '60-80'
    elif length < 100:
        length_range = '80-100'
    else:
        length_range = '100+'
    
    prices = []
    for color_data in PRICE_TABLE[length_range].values():
        prices.extend(color_data.values())
    
    return {
        'min': min(prices),
        'max': max(prices),
    }


if __name__ == '__main__':
    print("=" * 70)
    print("ПРИМЕРЫ РАСЧЕТА ПО ТОЧНОЙ ТАБЛИЦЕ")
    print("=" * 70)
    
    tests = [
        (60, 'блонд', 'славянка', 35000),
        (60, 'блонд', 'среднее', 30000),
        (60, 'русые', 'среднее', 28000),
        (100, 'каштановые', 'gusty', 58000),
    ]
    
    for length, color, structure, expected in tests:
        result = calculate_hair_price(length, color, structure)
        status = "✓" if result == expected else "✗"
        print(f"{status} {length}см, {color}, {structure}: {result:,} ₽")
