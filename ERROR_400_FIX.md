# üîü –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—à–∏–±–∫–∞ 400 –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏

**–î–∞—Ç–∞:** 15 –¥–µ–∫–∞–±—Ä—è 2025, 10:01 MSK
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ö–æ–º–º–∏—Ç—ã:** 
- f92ddc9a - fix: improve form validation
- 8decb1ff - fix: override create() method for proper error handling

---

## üî¥ –ß–¢–û –ë–´–õ–û –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:

–í `views.py` –Ω–µ –±—ã–ª–æ **–°–û–ë–°–¢–í–ï–ù–ù–û–ì–û –º–µ—Ç–æ–¥–∞ `create()`** –≤ `HairApplicationViewSet`!

–£ Django REST Framework –µ—Å—Ç—å generic `create()`, –Ω–æ –æ–Ω –ù–ï –ü–ï–†–ï–•–í–ê–¢–´–í–ê–ï–¢ `ValidationError` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç generic HTTP 400 –±–µ–∑ –ø–æ–Ω—è—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
‚ùå { "phone": [Array(1)] }  // –ù–µ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –Ω–µ —Ç–∞–∫!
```

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–ª `create()` –º–µ—Ç–æ–¥

–î–æ–±–∞–≤–∏–ª **–°–û–ë–°–¢–í–ï–ù–ù–´–ô `create()` –º–µ—Ç–æ–¥** –≤ `HairApplicationViewSet`:

```python
def create(self, request, *args, **kwargs):
    """
    ‚úÖ –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–Å–ù–ù–´–ô create() –¥–ª—è –ü–†–ê–í–ò–õ–¨–ù–û–ô –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
    """
    try:
        logger.info(f"Creating hair application with data: {request.data}")
        
        # –°–æ–∑–¥–∞—ë–º serializer —Å –¥–∞–Ω–Ω—ã–º–∏
        serializer = self.get_serializer(data=request.data)
        
        # –ü—ã—Ç–∞–µ–º—Å—è –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å
        try:
            serializer.is_valid(raise_exception=True)  # ‚úÖ –í—ã–±—Ä–æ—Å–∏—Ç ValidationError –µ—Å–ª–∏ –Ω–µ –≤–∞–ª–∏–¥–Ω–æ
        except ValidationError as e:
            # ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ü–û–ù–Ø–¢–ù–´–ô –æ—Ç–≤–µ—Ç
            logger.warning(f"Validation errors: {e.detail}")
            return Response(
                {
                    'status': 'error',
                    'message': '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–æ–ª—è.',
                    'errors': e.detail  # ‚úÖ –í–æ—Ç —Ç—É—Ç –≤–∏–¥–Ω—ã –¢–û–ß–ù–´–ï –æ—à–∏–±–∫–∏!
                },
                status=status.HTTP_400_BAD_REQUEST
            )
        
        # –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º perform_create
        self.perform_create(serializer)
        
        return Response(
            {
                'status': 'success',
                'message': '–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!',
                'data': serializer.data
            },
            status=status.HTTP_201_CREATED
        )
        
    except Exception as e:
        logger.error(f'Error creating hair application: {e}', exc_info=True)
        return Response(
            {
                'status': 'error',
                'message': f'–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {str(e)}',
            },
            status=status.HTTP_500_INTERNAL_SERVER_ERROR
        )
```

### –¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∞ 400 –±—É–¥–µ—Ç –ü–û–ù–Ø–¢–ù–û–ô:

```json
‚úÖ {
  "status": "error",
  "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–æ–ª—è.",
  "errors": {
    "phone": ["–¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 11 —Ü–∏—Ñ—Ä. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: +7 999 123 45 67"],
    "photo1": ["–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –º–∏–Ω–∏–º—É–º 1 —Ñ–æ—Ç–æ (\"–§–æ—Ç–æ 1\")"]
  }
}
```

---

## üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï:

```bash
ssh root@4895c9d9450e.vps.myjino.ru
cd /path/to/hair_purchase_site

git pull origin main
sudo systemctl restart hair-purchase
journalctl -u hair-purchase -f
```

–ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
```bash
bash deploy.sh
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê:

1. **–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞:** `Ctrl+Shift+Delete` ‚Üí –í—Å–µ –≤—Ä–µ–º—è ‚Üí –£–¥–∞–ª–∏—Ç—å
2. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É:** `F5`
3. **–¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –ë–ï–ó –§–û–¢–û**
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å—ë –∫—Ä–æ–º–µ —Ñ–æ—Ç–æ
   - –ù–∞–∂–∞—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
   - **–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–≤–µ—Ç:**
     ```json
     {
       "status": "error",
       "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–æ–ª—è.",
       "errors": {
         "photo1": ["–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –º–∏–Ω–∏–º—É–º 1 —Ñ–æ—Ç–æ (\"–§–æ—Ç–æ 1\")"]
       }
     }
     ```

4. **–¢–µ—Å—Ç 2: –ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å**
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–Ω–∏–º—É–º —Ñ–æ—Ç–æ 1
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
   - –ù–∞–∂–∞—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
   - **–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–≤–µ—Ç:**
     ```json
     {
       "status": "success",
       "message": "–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!",
       "data": { ... }
     }
     ```

5. **–¢–µ—Å—Ç 3: –¢–µ–ª–µ—Ñ–æ–Ω –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö**
   - `+79991234567` ‚úÖ OK
   - `79991234567` ‚úÖ OK (–Ω–æ—Ä–º–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è)
   - `89991234567` ‚úÖ OK (–Ω–æ—Ä–º–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è)
   - `+7 999 123 45 67` ‚úÖ OK (–Ω–æ—Ä–º–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è)

---

## üìä –ò–¢–û–ì–û: –í–°–ï –û–®–ò–ë–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–´!

| # | –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ | –ö–æ–º–º–∏—Ç |
|-|--------|---------|--------|--------|
| 1 | 500 –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ | –î–∏–∞–ø–∞–∑–æ–Ω—ã "50-60" –Ω–µ –ø–∞—Ä—Å–∏–ª–∏—Å—å | try-except + fallback | be32a9e4 |
| 2 | –¶–µ–Ω–∞ 30,000 –≤–º–µ—Å—Ç–æ 65,000 | '100+' –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ '100+' –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å | cce8a497 |
| 3 | 400 –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏ | –§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª | normalize_phone() + –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã | f9049db5 |
| 4 | **‚ú® –ù–û–í–û–ï: Generic 400 –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π** | **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ ValidationError** | **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ create()** | **8decb1ff** |

---

## üéâ –ì–û–¢–û–í–û –ö PRODUCTION!

–¢–µ–ø–µ—Ä—å —Å–∞–π—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π, —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏!
