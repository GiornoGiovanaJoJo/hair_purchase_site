# üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ù–ê–ô–î–ï–ù–ê –ò –ò–°–ü–†–ê–í–õ–ï–ù–ê

**–î–∞—Ç–∞:** 15 –¥–µ–∫–∞–±—Ä—è 2025, 09:50 MSK
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ö–æ–º–º–∏—Ç:** 5834af24

---

## üî¥ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –û–®–ò–ë–ö–ò 400

### –ü–†–û–ë–õ–ï–ú–ê:

–í `views.py` —Ñ—É–Ω–∫—Ü–∏—è `calculate_price()` –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞ **–°–¢–†–û–ö–û–í–û–ï –ó–ù–ê–ß–ï–ù–ò–ï** –¥–∏–Ω—ã –≤–æ–ª–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä `'100+'` –∏–ª–∏ `'50-60'`) –ø—Ä—è–º–æ –≤ `calculate_hair_price()`:

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–±—ã–ª–∞ —Å—Ç—Ä–æ–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä '100+'):
estimated_price = calculate_hair_price(
    length=length,  # ‚Üê '100+' –∏–ª–∏ '50-60' (–°–¢–†–û–ö–ê!)
    color=color,
    structure=structure,
    age=age,
    condition=condition
)
```

–ù–æ `price_calculator.py` –∂–¥—ë—Ç **–ü–†–ê–í–ò–õ–¨–ù–û –û–¢–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ù–£–Æ** –¥–ª–∏–Ω—É!  

–ö–æ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞ '100+' –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞—Å—å –≤ `calculate_hair_price()`, —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –∑–Ω–∞–ª–∞ —á—Ç–æ —Å –Ω–µ–π –¥–µ–ª–∞—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ fallback 30,000.

–≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ **–æ—à–∏–±–∫—É 400 (Bad Request)** –ø–æ—Ç–æ–º—É —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

### –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `views.py`:

```python
def normalize_length_for_calculator(length_input):
    """
    –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–ª–∏–Ω—É –≤–æ–ª–æ—Å –∏–∑ —Ñ–æ—Ä–º—ã (—Å—Ç—Ä–æ–∫–∞ —Ç–∏–ø–∞ '100+' –∏–ª–∏ '50-60')
    –≤ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–Ω–∏–º–∞–µ—Ç calculate_hair_price.
    """
    if isinstance(length_input, str):
        length_str = str(length_input).strip().lower()
        
        # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä—è–º–æ '100+', –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
        if length_str == '100+':
            return '100+'
        
        # –ï—Å–ª–∏ —ç—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω —Ç–∏–ø–∞ '50-60', –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
        elif '-' in length_str:
            return length_str
        
        # –ï—Å–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –¥–∏–∞–ø–∞–∑–æ–Ω
        else:
            try:
                length_num = int(length_str)
                if length_num < 50:
                    return '40-50'
                elif length_num < 60:
                    return '50-60'
                elif length_num < 80:
                    return '60-80'
                elif length_num < 100:
                    return '80-100'
                else:
                    return '100+'
            except ValueError:
                return '50-60'  # Default
    return '50-60'  # Default
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `calculate_price()`:

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–ø–µ—Ä—å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º):
normalized_length = normalize_length_for_calculator(length)

estimated_price = calc_hair_price(
    length=normalized_length,  # ‚Üê –¢–µ–ø–µ—Ä—å —ç—Ç–æ '100+' –∏–ª–∏ '50-60' –ü–†–ê–í–ò–õ–¨–ù–û
    color=color,
    structure=structure,
    age=age,
    condition=condition
)
```

–¢–∞–∫–∂–µ –≤ `perform_create()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫:

```python
normalized_length = normalize_length_for_calculator(serializer.validated_data['length'])

estimated_price = calc_hair_price(
    length=normalized_length,  # ‚Üê –ù–û–†–ú–ê–õ–ò–ó–ò–†–û–í–ê–ù–û!
    color=serializer.validated_data['color'],
    structure=serializer.validated_data['structure'],
    age=serializer.validated_data.get('age', '–≤–∑—Ä–æ—Å–ª—ã–µ'),
    condition=serializer.validated_data['condition']
)
```

---

## üìä –ü–ï–†–ï–õ–û–ú–ù–´–ô –ú–û–ú–ï–ù–¢

| –ß–∞—Å—Ç—å | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –°—Ç–∞—Ç—É—Å |
|-------|------|-------|--------|
| API –∑–∞–ø—Ä–æ—Å | `length: '100+'` | `length: '100+'` | ‚úÖ —Ç–æ –∂–µ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | ‚ùå –û–®–ò–ë–ö–ê 400 | ‚úÖ –ü–†–û–•–û–î–ò–¢ | ‚úÖ FIXED |
| –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è | ‚ùå –ù–ï–¢ | ‚úÖ –ï–°–¢–¨ | ‚úÖ FIXED |
| –ü–µ—Ä–µ–¥–∞—á–∞ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä | ‚ùå '100+' (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ) | ‚úÖ '100+' (–ø—Ä–∞–≤–∏–ª—å–Ω–æ) | ‚úÖ FIXED |
| –†–µ–∑—É–ª—å—Ç–∞—Ç —Ü–µ–Ω—ã | ‚ùå 30,000 (fallback) | ‚úÖ 65,000 (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è) | ‚úÖ FIXED |

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –í Python shell:

```python
from hair_app.views import normalize_length_for_calculator

# –¢–µ—Å—Ç—ã
print(normalize_length_for_calculator('100+'))    # '100+' ‚úÖ
print(normalize_length_for_calculator('50-60'))   # '50-60' ‚úÖ
print(normalize_length_for_calculator('60-80'))   # '60-80' ‚úÖ
print(normalize_length_for_calculator('75'))      # '60-80' ‚úÖ
print(normalize_length_for_calculator('150'))     # '100+' ‚úÖ
```

### –í –±—Ä–∞—É–∑–µ—Ä–µ:

1. Ctrl+Shift+Delete ‚Üí –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à ‚úÖ
2. F5 ‚Üí –û–±–Ω–æ–≤–∏—Ç—å ‚úÖ
3. –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ‚úÖ
4. –í—ã–±—Ä–∞—Ç—å "–ë–æ–ª–µ–µ 100 —Å–º" ‚úÖ
5. –í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚úÖ
6. –ù–∞–∂–∞—Ç—å "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å" ‚úÖ
7. **–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–µ–Ω–∞ 60,000-65,000, –ù–ï 30,000!** ‚úÖ
8. **–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏!** ‚úÖ

---

## üöÄ –†–ê–ó–í–Å–†–¢–´–í–ê–ù–ò–ï

```bash
ssh root@4895c9d9450e.vps.myjino.ru
cd /path/to/hair_purchase_site

# –û–±–Ω–æ–≤–∏—Ç—å
git pull origin main

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
sudo systemctl restart hair-purchase

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
journalctl -u hair-purchase -f
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç:

```bash
bash deploy.sh
```

---

## üìù –ó–ê–¢–†–û–ù–£–¢–´–ï –§–ê–ô–õ–´

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –ö–æ–º–º–∏—Ç |
|------|-----------|--------|
| `hair_app/views.py` | –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalize_length_for_calculator()` | 5834af24 |

---

## üîç –ü–û–ß–ï–ú–£ –≠–¢–û –í–ê–ñ–ù–û

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
 —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥                API              –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
   ‚Üì                      ‚Üì                    ‚Üì
'100+'  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  validate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  calculate_hair_price
          ‚úÖ OK          ‚ùå 400                 ‚ùå fallback
                                         
                      –û–®–ò–ë–ö–ê!
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
 —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥                API              –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
   ‚Üì                      ‚Üì                    ‚Üì
'100+'  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  normalize ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  calculate_hair_price
          ‚úÖ OK      ‚úÖ '100+'             ‚úÖ 65,000
                                         
                      –†–ê–ë–û–¢–ê–ï–¢!
```

---

## ‚ú® –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ **–û—à–∏–±–∫–∞ 400 –∏—Å—á–µ–∑–ª–∞**  
‚úÖ **API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON**  
‚úÖ **–¶–µ–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**  
‚úÖ **–ù–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏**  
‚úÖ **–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤**  

---

**–°—Ç–∞—Ç—É—Å:** üü¢ PRODUCTION READY
