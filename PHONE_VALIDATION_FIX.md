# üìÑ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–®–ò–ë–ö–ê 400 –ü–û –¢–ï–õ–ï–§–û–ù–£

**–î–∞—Ç–∞:** 15 –¥–µ–∫–∞–±—Ä—è 2025, 09:53 MSK
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ö–æ–º–º–∏—Ç:** f9049db5

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê: –û–®–ò–ë–ö–ê 400 –ü–û –¢–ï–õ–ï–§–û–ù–£

### –ö–£–î–ê –≠–¢–û –ü–†–û–ò—Å–•–û–î–ò–¢:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç **–£ –û–ú–û–õ–ß–ê–ù–ò–ï –õ–Æ–ë–û–ô –§–û–†–ú–ê–¢** —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
   - `+79991234567` (10 —Ü–∏—Ñ—Ä –±–µ–∑ —Å–∫–æ–±–æ–∫)
   - `+7 999 123 45 67` (—Å–æ —Å–ø–∞—Ü–µ–º)
   - `+7 (999) 123-45-67` (—Å —Å–∫–æ–±–∫–∞–º–∏)
   - `79991234567` (–±–µ–∑ +)
   - `89991234567` (–Ω–∞—á–∏–Ω–∞—è —Å 8)

2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ –¢–û–ú –í–ò–î–ï, –í –ö–û–¢–û–†–û–ú –û–ù –í–í–≠–õ

3. `models.py` —Å –†–µ–≥–µ–∫—Å–û–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

```python
phone_validator = RegexValidator(
    regex=r'^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$',
    message='–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (999) 123-45-67',
    code='invalid_phone_format'
)
```

**—Ä–µ–≥–µ–∫—Å —Ç—Ä–µ–±—É–µ—Ç –¢–û–ß–ù–û (–¢–¢–û! ‚Üí **–û–®–ò–ë–ö–ê 400**

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï: –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ï–õ–ï–§–û–ù–ê

### –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalize_phone()` –≤ `models.py`:

```python
def normalize_phone(phone_value):
    """
    –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç +7 (999) 123-45-67
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç:
    - +79991234567
    - +7 999 123 4567
    - +7 (999) 123-45-67
    - 79991234567
    - 89991234567
    """
    if not phone_value:
        return phone_value
    
    # –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ +
    cleaned = ''.join(c for c in str(phone_value) if c.isdigit() or c == '+')
    
    # –ï—Å–ª–∏ –Ω–µ—Ç +, –¥–æ–±–∞–≤–ª—è–µ–º
    if not cleaned.startswith('+'):
        # –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ 7
        if cleaned.startswith('8'):
            cleaned = '7' + cleaned[1:]
        elif not cleaned.startswith('7'):
            cleaned = '7' + cleaned
        else:
            cleaned = '+' + cleaned
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ 11 —Ü–∏—Ñ—Ä
    digits = ''.join(c for c in cleaned if c.isdigit())
    if not (cleaned.startswith('+7') and len(digits) == 11):
        return phone_value
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ +7 (999) 123-45-67
    return f"+{digits[0]} ({digits[1:4]}) {digits[4:7]}-{digits[7:9]}-{digits[9:11]}"
```

### –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `clean()` –∏ `save()`:

```python
class HairApplication(models.Model):
    # ...
    
    def clean(self):
        """
        –û—á–∏—â–∞–µ–º –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ.
        """
        # –ù–û–†–ú–ê–õ–ò–ó–£–ï–ú –¢–ï–õ–ï–§–û–ù –ö –§–û–†–ú–ê–¢–£ +7 (999) 123-45-67
        self.phone = normalize_phone(self.phone)
    
    def save(self, *args, **kwargs):
        """
        –í—ã–∑—ã–≤–∞–µ–º clean() –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
        """
        self.clean()  # ‚úÖ –ù–û–†–ú–ê–õ–ò–ó–ò–†–£–ï–ú –¢–ï–õ–ï–§–û–ù –ü–ï–†–ï–î –°–û–•–†–ê–ù–ï–ù–ò–ï–ú
        # ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∫–æ–¥
        super().save(*args, **kwargs)
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ò

| –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ù–û–†–ú–ê–õ–∏–∑–æ–≤–∞–Ω–Ω–æ | –†–µ–≥–µ–∫—Å –ü–†–û–•–û–î–´–¢ |
|---|---|---|
| `+79991234567` | `+7 (999) 123-45-67` | ‚úÖ YES |
| `+7 999 123 4567` | `+7 (999) 123-45-67` | ‚úÖ YES |
| `+7 (999) 123-45-67` | `+7 (999) 123-45-67` | ‚úÖ YES |
| `79991234567` | `+7 (999) 123-45-67` | ‚úÖ YES |
| `89991234567` | `+7 (999) 123-45-67` | ‚úÖ YES |
| `9991234567` | `+7 (999) 123-45-67` | ‚úÖ YES |

---

## üìä –ò–¢–û–ì–û–í–û

### –ß—Ç–æ –Ω–æ–≤–æ?

```
–ü–û–õ—å–∑–æ–≤–∞—Ç–µ–ª—å  –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å  –î–ë
   ‚Üì              ‚Üì         ‚Üì
+79991234567 ‚Üí normalize_phone() ‚Üí +7 (999) 123-45-67 ‚Üí regex OK ‚úÖ
```

### –° –≠—Ç–ò–ú

- ‚úÖ –û–®–ò–ë–ö–∞ 400 –∏—Å—á–µ–∑–Ω–µ—Ç
- ‚úÖ –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ï–õ–ï–§–û–ù–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –∏—Å–∏–ø—Ä–∞–≤–ª—è—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –∏–º–µ–Ω—è—Ç—å JavaScript
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–≤–æ–¥–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –ö–ê–ö –£–ì–û–î–ù–û

---

## üöÄ –†–ê–ó–í–Å–†–¢–´–í–ê–ù–ò–ï

```bash
# 1. SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@4895c9d9450e.vps.myjino.ru
cd /path/to/hair_purchase_site

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# 3. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å (–Ω–æ–≤—ã—Ö –Ω–æ–≤ changes –≤ models –Ω–µ—Ç)
python manage.py migrate

# 4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Django
sudo systemctl restart hair-purchase

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
journalctl -u hair-purchase -f
```

–∏–ª–∏ –æ–¥–Ω–∏–º –∫–æ–º–∞–Ω–¥–æ–π:

```bash
bash deploy.sh
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

### –í –±—Ä–∞—É–∑–µ—Ä–µ:

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –∑–∞—è–≤–∫–∏
2. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤ –õ–Æ–ë–û–ú —Ñ–æ—Ä–º–∞—Ç–µ:
   - `79991234567` (–±–µ–∑ +)
   - `+79991234567` (—Å +)
   - `+7 999 123 45 67` (—Å–æ —Å–ø–∞—Ü–µ–º)
   - `8 999 123 45 67` (—Å 8)
3. –ù–∞–ø–æ–ª–Ω–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
5. **–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–∫–∏ 400!** ‚úÖ

---

## üìö –ö–û–ú–ú–ò–¢–´

```
f9049db5 - fix: add phone normalization function to handle various phone formats
e8c510ee - docs: add critical bug fix documentation
5834af24 - fix: add length normalization function to handle string values
```

---

**–ì–æ—Ç–æ–≤–æ –∫ production deployment!** üéâ
