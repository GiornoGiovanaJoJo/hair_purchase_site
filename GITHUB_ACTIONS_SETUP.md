# GitHub Actions CI/CD Setup Guide

## üéØ –¶–µ–ª—å
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ main –≤–µ—Ç–∫—É.

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ‚úÖ SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—É–∂–µ —Å–æ–∑–¥–∞–Ω)
- ‚úÖ GitHub Secrets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é

---

## üîß –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å GitHub Secrets

### –ü–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ:
```
https://github.com/GiornoGiovanaJoJo/hair_purchase_site/settings/secrets/actions
```

### –î–æ–±–∞–≤—å 4 —Å–µ–∫—Ä–µ—Ç–∞ (New repository secret):

#### 1. DEPLOYHOST
- **Name:** `DEPLOYHOST`
- **Value:** `4895c9d9450e.vps.myjino.ru`

#### 2. DEPLOYUSER
- **Name:** `DEPLOYUSER`
- **Value:** `root`

#### 3. DEPLOYPORT
- **Name:** `DEPLOYPORT`
- **Value:** `22`

#### 4. DEPLOYSSHKEY (—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π!)
- **Name:** `DEPLOYSSHKEY`
- **Value:** –í–µ—Å—å —Ç–µ–∫—Å—Ç –∏–∑ –∫–æ–º–∞–Ω–¥—ã:
```bash
cat ~/.ssh/id_rsa
```

–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–ª—é—á–∞:
```
-----BEGIN OPENSSH PRIVATE KEY-----
[–≤–µ—Å—å –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç BEGIN –¥–æ END]
-----END OPENSSH PRIVATE KEY-----
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** 
- –£–±–µ–¥–∏—Å—å —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –í–°–ï —Å—Ç—Ä–æ–∫–∏
- –í–∫–ª—é—á–∞—è BEGIN –∏ END —Å—Ç—Ä–æ–∫–∏
- –ù–µ —É–±–∏—Ä–∞–π –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
- –ù–µ –æ–±—Ä–µ–∑–∞–π –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü

---

## üöÄ –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å workflow

### –ü–µ—Ä–µ–π–¥–∏ –≤ Actions:
```
https://github.com/GiornoGiovanaJoJo/hair_purchase_site/actions
```

–¢–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–±–æ—á–∏–µ workflows:
- ‚úÖ **Django CI/CD Pipeline** - –æ—Å–Ω–æ–≤–Ω–æ–π workflow
- ‚úÖ **Tests & Checks** - —ç—Ç–∞–ø —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **Deploy** - —ç—Ç–∞–ø —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## üìù –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–ù–∞ push –≤ main –≤–µ—Ç–∫—É**
   ```bash
   git push origin main
   ```

2. **GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç workflow:**
   - üß™ Runs Tests & Checks
   - üöÄ Deploy to Production
   - üìß Notify on Failure (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞)

3. **–î–µ–ø–ª–æ–π –¥–µ–ª–∞–µ—Ç:**
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Å–≤–µ–∂–∏–π –∫–æ–¥
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
   - –°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ä–≤–∏—Å Django
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –±–æ—Ç Telegram
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è:
```
https://github.com/GiornoGiovanaJoJo/hair_purchase_site/actions
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:
- ‚úÖ **Success** - –¥–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- üü° **In Progress** - –¥–µ–ø–ª–æ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚ùå **Failed** - –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:
1. –ö–ª–∏–∫–Ω–∏ –Ω–∞ failed workflow
2. –†–∞—Å–∫—Ä–æ–π "Deploy to Production"
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –∫–æ–º–∞–Ω–¥

---

## üîç Troubleshooting

### –û—à–∏–±–∫–∞: "Permission denied (publickey)"
**–†–µ—à–µ–Ω–∏–µ:** SSH –∫–ª—é—á –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –≤–µ—Å—å –∫–ª—é—á
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏ –≤ GitHub Secrets

### –û—à–∏–±–∫–∞: "Host key verification failed"
**–†–µ—à–µ–Ω–∏–µ:** –°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ known_hosts
- –≠—Ç–æ –æ–±—ã—á–Ω–æ GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—à–∞–µ—Ç
- –ï—Å–ª–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä—å DEPLOYHOST

### –î–µ–ø–ª–æ–π –∑–∞–≤–∏—Å–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä–≤–∏—Å `hair-purchase` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `journalctl -u hair-purchase -n 50`

### "No such file or directory: /opt/hair_purchase_site"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞ –º–µ—Å—Ç–µ –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—É—Ç—å
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –≤ `/opt/hair_purchase_site`
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏ –ø—É—Ç—å –≤ workflow —Ñ–∞–π–ª–µ

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–º–æ—Ç—Ä–∏ —Å—Ç–∞—Ç—É—Å:
```bash
# –°—Ç–∞—Ç—É—Å Django —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl status hair-purchase

# –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
sudo systemctl status hair-purchase-bot

# –õ–æ–≥–∏ Django
journalctl -u hair-purchase -n 50 -f

# –õ–æ–≥–∏ –±–æ—Ç–∞
journalctl -u hair-purchase-bot -n 50 -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8000
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### SSH –∫–ª—é—á –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø–æ—Ç–æ–º—É —á—Ç–æ:
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—Å—è –≤ GitHub Secrets (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)
- ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- ‚úÖ –ù–µ –≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö
- ‚úÖ –ú–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —É–¥–∞–ª–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å

### –ï—Å–ª–∏ –∫–ª—é—á —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω:
1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π –∫–ª—é—á:
   ```bash
   rm ~/.ssh/id_rsa*
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
   ```
2. –í GitHub –æ–±–Ω–æ–≤–∏ Secret `DEPLOYSSHKEY`

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
cd ~
rm -rf .ssh/id_rsa*
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
cat ~/.ssh/id_rsa
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
ssh-keygen -l -f ~/.ssh/id_rsa
```

### –ú–∞–Ω—É–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω):
```bash
cd /opt/hair_purchase_site
git fetch origin main
git reset --hard origin/main
source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py collectstatic --noinput
sudo systemctl restart hair-purchase
```

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ main –≤–µ—Ç–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è! üöÄ

```bash
# –ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π commit –∏ push
git add .
git commit -m "Fix: something"
git push origin main

# –ò —Å–º–æ—Ç—Ä–∏ –≤ Actions –∫–∞–∫ –≤—Å–µ –¥–µ–ø–ª–æ–∏—Ç—Å—è üìä
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ GitHub Actions
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤—Å–µ Secrets –¥–æ–±–∞–≤–ª–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SSH
